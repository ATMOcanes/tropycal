

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tropycal.realtime.realtime &mdash; tropycal </title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/logo_32.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'0.3.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> tropycal
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_usage.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Data Sources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tropycal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>tropycal.realtime.realtime</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tropycal.realtime.realtime</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Functionality for managing real-time tropical cyclone data.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span><span class="n">timedelta</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
    <span class="kn">from</span> <span class="nn">cartopy</span> <span class="k">import</span> <span class="n">crs</span> <span class="k">as</span> <span class="n">ccrs</span>
    <span class="kn">from</span> <span class="nn">cartopy.mpl.gridliner</span> <span class="k">import</span> <span class="n">LONGITUDE_FORMATTER</span><span class="p">,</span> <span class="n">LATITUDE_FORMATTER</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warn_message</span> <span class="o">=</span> <span class="s2">&quot;Warning: Cartopy is not installed in your python environment. Plotting functions will not work.&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warn_message</span><span class="p">)</span>

<span class="c1">#Internal imports</span>
<span class="kn">from</span> <span class="nn">.storm</span> <span class="k">import</span> <span class="n">RealtimeStorm</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">constants</span>

<div class="viewcode-block" id="Realtime"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.Realtime.html#tropycal.realtime.Realtime">[docs]</a><span class="k">class</span> <span class="nc">Realtime</span><span class="p">():</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of a Realtime object containing currently active tropical cyclones and invests.</span>
<span class="sd">    </span>
<span class="sd">    Realtime objects are used to retrieve RealtimeStorm objects, which are created for every active tropical cyclone globally upon creating an instance of Realtime.</span>
<span class="sd">    </span>
<span class="sd">    Data sources are as follows:</span>
<span class="sd">    National Hurricane Center (NHC): https://ftp.nhc.noaa.gov/atcf/btk/</span>
<span class="sd">    Joint Typhoon Warning Center (JTWC): (read notes for more details)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    jtwc : bool, optional</span>
<span class="sd">        Flag determining whether to read JTWC data in. If True, specify the JTWC data source using &quot;jtwc_source&quot;. Default is False.</span>
<span class="sd">    jtwc_source : str, optional</span>
<span class="sd">        If jtwc is set to True, this specifies the JTWC data source to read from. Available options are &quot;noaa&quot;, &quot;ucar&quot; or &quot;jtwc&quot;. Default is &quot;jtwc&quot;. Read the notes for more details.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tropycal.realtime.Realtime</span>
<span class="sd">        An instance of Realtime.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    As of 2021, the multiple sources offering a Best Track archive of raw JTWC tropical cyclone data experienced frequent outages and/or severe slowdowns, hampering the ability to easily retrieve this data. As such, JTWC data has been optional in Realtime objects since v0.2.7. There are three JTWC sources available:</span>
<span class="sd">    </span>
<span class="sd">    * **jtwc** - This is currently the default JTWC source if JTWC data is read in. As of September 2021, this source is working, but reading data is exceptionally slow (can take from 3 to as much as 10 minutes).</span>
<span class="sd">    * **ucar** - As of September 2021, this source is available and fairly quick to read in, but offers a less compherensive storm history than the &quot;jtwc&quot; source. Between July and September 2021, this source did not update any active tropical cyclones outside of NHC&#39;s domain. If using this source, check to make sure it is in fact retrieving current global tropical cyclones.</span>
<span class="sd">    * **noaa** - This source was active until about July 2021, and since then no longer appears to be online and accessible. The code retains the ability to read in data from this source should it return online.</span>
<span class="sd">    </span>
<span class="sd">    The following block of code creates an instance of a Realtime() object and stores it in a variable called &quot;realtime_obj&quot;:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">        from tropycal import realtime</span>
<span class="sd">        realtime_obj = realtime.Realtime()</span>
<span class="sd">        </span>
<span class="sd">    With an instance of Realtime created, any of the methods listed below can be accessed via the &quot;realtime_obj&quot; variable. All active storms and invests are stored as attributes of this instance, and can be simply retrieved:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">        #This stores an instance of a RealtimeStorm object for AL012021 in the &quot;storm&quot; variable.</span>
<span class="sd">        storm = realtime_obj.AL012021</span>
<span class="sd">        </span>
<span class="sd">        #From there, you can use any method of a Storm object:</span>
<span class="sd">        storm.plot()</span>
<span class="sd">    </span>
<span class="sd">    RealtimeStorm objects contain all the methods of Storm objects, in addition to special methods available only for storms retrieved via a Realtime object. As of Tropycal v0.3, this now includes invests, though Storm and RealtimeStorm objects retrieved for invests are blocked from performing functionality that does not apply to invests operationally (e.g., forecast discussions, official NHC/JTWC track forecasts).</span>
<span class="sd">    </span>
<span class="sd">    To check whether a RealtimeStorm object contains an invest, check the &quot;invest&quot; boolean stored in it:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">        if storm.invest == True:</span>
<span class="sd">            print(&quot;This is an invest!&quot;)</span>
<span class="sd">        else:</span>
<span class="sd">            print(&quot;This is not an invest!&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.realtime.Realtime&gt;&quot;</span><span class="p">]</span>

        <span class="c1">#Add general summary</span>
        
        <span class="c1">#Add dataset summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dataset Summary:&quot;</span><span class="p">)</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{&quot; &quot;*4}Numbers of active storms: {len(self.storms)}&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Active Storms:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">storms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;invest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{&quot; &quot;*4}</span><span class="si">{key}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Active Invests:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">storms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;invest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{&quot; &quot;*4}</span><span class="si">{key}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">jtwc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">jtwc_source</span><span class="o">=</span><span class="s1">&#39;ucar&#39;</span><span class="p">):</span>
        
        <span class="c1">#Define empty dict to store track data in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Time data reading</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Starting to read in current storm data&quot;</span><span class="p">)</span>
        
        <span class="c1">#Read in best track data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_btk</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">jtwc_source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ucar&#39;</span><span class="p">,</span><span class="s1">&#39;noaa&#39;</span><span class="p">,</span><span class="s1">&#39;jtwc&#39;</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">jtwc_source</span><span class="se">\&quot;</span><span class="s2"> must be either </span><span class="se">\&quot;</span><span class="s2">ucar</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">noaa</span><span class="se">\&quot;</span><span class="s2">, or </span><span class="se">\&quot;</span><span class="s2">jtwc</span><span class="se">\&quot;</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jtwc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_btk_jtwc</span><span class="p">(</span><span class="n">jtwc_source</span><span class="p">)</span>
        
        <span class="c1">#Determine time elapsed</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">tsec</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time_elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;--&gt; Completed reading in current storm data (</span><span class="si">{tsec}</span><span class="s2"> seconds)&quot;</span><span class="p">)</span>
        
        <span class="c1">#Remove storms that haven&#39;t been active in 18 hours</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
            
            <span class="c1">#Filter for storm duration</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">continue</span>
            
            <span class="c1">#Get last date</span>
            <span class="n">last_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">current_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
            
            <span class="c1">#Get time difference</span>
            <span class="n">hours_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_date</span> <span class="o">-</span> <span class="n">last_date</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mf">3600.0</span>
            <span class="k">if</span> <span class="n">hours_diff</span> <span class="o">&gt;=</span> <span class="mf">18.0</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;invest&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">hours_diff</span> <span class="o">&gt;=</span> <span class="mf">9.0</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
        <span class="c1">#For each storm remaining, create a Storm object</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">RealtimeStorm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="c1">#Delete data dict while retaining active storm keys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storms</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="c1">#Create an empty list signaling no active storms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    
    <span class="k">def</span> <span class="nf">__read_btk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in best track data into the Dataset object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Get current year</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>

        <span class="c1">#Get list of files in online directory</span>
        <span class="n">use_ftp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://ftp.nhc.noaa.gov/atcf/btk/&#39;</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">use_ftp</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;ftp://ftp.nhc.noaa.gov/atcf/btk/&#39;</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1">#Get relevant filenames from directory</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">search_pattern</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;b[aec][lp][012349][0123456789]</span><span class="si">{current_year}</span><span class="s1">.dat&#39;</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1">#For each file, read in file content and add to hurdat dict</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

            <span class="c1">#Get file ID</span>
            <span class="n">stormid</span> <span class="o">=</span> <span class="p">((</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            
            <span class="c1">#Check for invest status</span>
            <span class="n">invest_bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="n">invest_bool</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1">#Determine basin</span>
            <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
            <span class="k">if</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>
            <span class="k">elif</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>

            <span class="c1">#add empty entry into dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">stormid</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="n">stormid</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="n">add_basin</span><span class="p">,</span><span class="s1">&#39;source_info&#39;</span><span class="p">:</span><span class="s1">&#39;NHC Hurricane Database&#39;</span><span class="p">,</span><span class="s1">&#39;realtime&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;invest&#39;</span><span class="p">:</span><span class="n">invest_bool</span><span class="p">,</span><span class="s1">&#39;source_method&#39;</span><span class="p">:</span><span class="s2">&quot;NHC&#39;s Automated Tropical Cyclone Forecasting System (ATCF)&quot;</span><span class="p">,</span><span class="s1">&#39;source_url&#39;</span><span class="p">:</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/btk/&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hurdat&#39;</span>

            <span class="c1">#add empty lists</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1">#Read in file</span>
            <span class="k">if</span> <span class="n">use_ftp</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/btk/</span><span class="si">{file}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/btk/</span><span class="si">{file}</span><span class="s2">&quot;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">content_full</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="c1">#Check if transition is in keywords for invests</span>
            <span class="k">if</span> <span class="n">invest_bool</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="s1">&#39;TRANSITION&#39;</span> <span class="ow">in</span> <span class="n">content_full</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">]</span>
                <span class="k">continue</span>

            <span class="c1">#iterate through file lines</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span> <span class="k">continue</span>

                <span class="c1">#Get date of obs</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span> <span class="k">continue</span>

                <span class="c1">#Ensure obs aren&#39;t being repeated</span>
                <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span> <span class="k">continue</span>

                <span class="c1">#Get latitude into number</span>
                <span class="n">btk_lat_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">btk_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">btk_lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1">#Get longitude into number</span>
                <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                    <span class="n">btk_lon_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">btk_lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span>
                <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                    <span class="n">btk_lon_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">btk_lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1">#Get other relevant variables</span>
                <span class="n">btk_wind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">btk_mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
                <span class="n">btk_type</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span>
                
                <span class="c1">#Get last tropical date</span>
                <span class="k">if</span> <span class="n">btk_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">:</span>
                    <span class="n">last_tropical_date</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1">#Replace with NaNs</span>
                <span class="k">if</span> <span class="n">btk_wind</span> <span class="o">&gt;</span> <span class="mi">250</span> <span class="ow">or</span> <span class="n">btk_wind</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> <span class="n">btk_wind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">btk_mslp</span> <span class="o">&gt;</span> <span class="mi">1040</span> <span class="ow">or</span> <span class="n">btk_mslp</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span> <span class="n">btk_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1">#Add extra obs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1">#Append into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_lon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_mslp</span><span class="p">)</span>
                
                <span class="c1">#Add basin</span>
                <span class="k">if</span> <span class="n">add_basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                    <span class="n">wmo_agency</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
                <span class="k">elif</span> <span class="n">add_basin</span> <span class="o">==</span> <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">btk_lon</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">wmo_agency</span> <span class="o">=</span> <span class="s1">&#39;west_pacific&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">wmo_agency</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wmo_agency</span> <span class="o">=</span> <span class="s1">&#39;west_pacific&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_agency</span><span class="p">)</span>

                <span class="c1">#Calculate ACE &amp; append to storm total</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">btk_wind</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">btk_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1">#Add storm name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            
            <span class="c1">#Check if storm is still tropical, if not an invest.</span>
            <span class="c1">#Re-designate as an invest if has not been a TC for over 18 hours.</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">):</span>
                <span class="n">current_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
                <span class="n">date_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_date</span> <span class="o">-</span> <span class="n">last_tropical_date</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>
                <span class="k">if</span> <span class="n">date_diff</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;invest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        
        
    <span class="k">def</span> <span class="nf">__read_btk_jtwc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in b-deck data from the Tropical Cyclone Guidance Project (TCGP) into the Dataset object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Get current year</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>

        <span class="c1">#Get list of files in online directory</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;https://www.nrlmry.navy.mil/atcf_web/docs/tracks/</span><span class="si">{current_year}</span><span class="s1">/&#39;</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;noaa&#39;</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;https://www.ssd.noaa.gov/PS/TROP/DATA/ATCF/JTWC/&#39;</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ucar&#39;</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;http://hurricanes.ral.ucar.edu/repository/data/bdecks_open/</span><span class="si">{current_year}</span><span class="s1">/&#39;</span>
        <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1">#Get relevant filenames from directory</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">search_pattern</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;b[isw][ohp][01234][0123456789]</span><span class="si">{current_year}</span><span class="s1">.dat&#39;</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="c1">#Search for following year (for SH storms)</span>
        <span class="n">search_pattern</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;b[isw][ohp][01234][0123456789]{current_year+1}.dat&#39;</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1">#For each file, read in file content and add to hurdat dict</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

            <span class="c1">#Get file ID</span>
            <span class="n">stormid</span> <span class="o">=</span> <span class="p">((</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1">#Determine basin based on where storm developed</span>
            <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;west_pacific&#39;</span>
            <span class="k">if</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;north_indian&#39;</span>
            <span class="k">elif</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1">#add empty entry into dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">stormid</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="n">stormid</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="n">add_basin</span><span class="p">,</span><span class="s1">&#39;source_info&#39;</span><span class="p">:</span><span class="s1">&#39;Joint Typhoon Warning Center&#39;</span><span class="p">,</span><span class="s1">&#39;realtime&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;invest&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jtwc&#39;</span>
            
            <span class="c1">#Add source info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;JTWC ATCF&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;https://www.nrlmry.navy.mil/atcf_web/docs/tracks/</span><span class="si">{current_year}</span><span class="s1">/&#39;</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;noaa&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NOAA SSD&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;https://www.ssd.noaa.gov/PS/TROP/DATA/ATCF/JTWC/&#39;</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ucar&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UCAR&#39;s Tropical Cyclone Guidance Project (TCGP)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;http://hurricanes.ral.ucar.edu/repository/data/bdecks_open/&#39;</span>

            <span class="c1">#add empty lists</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1">#Read in file</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;https://www.nrlmry.navy.mil/atcf_web/docs/tracks/</span><span class="si">{current_year}</span><span class="s2">/</span><span class="si">{file}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;noaa&#39;</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;https://www.ssd.noaa.gov/PS/TROP/DATA/ATCF/JTWC/</span><span class="si">{file}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ucar&#39;</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;http://hurricanes.ral.ucar.edu/repository/data/bdecks_open/</span><span class="si">{current_year}</span><span class="s2">/</span><span class="si">{file}</span><span class="s2">&quot;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1">#iterate through file lines</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span> <span class="k">continue</span>

                <span class="c1">#Get date of obs</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span> <span class="k">continue</span>

                <span class="c1">#Ensure obs aren&#39;t being repeated</span>
                <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span> <span class="k">continue</span>

                <span class="c1">#Get latitude into number</span>
                <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
                    <span class="n">btk_lat_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">btk_lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
                    <span class="n">btk_lat_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">btk_lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1">#Get longitude into number</span>
                <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                    <span class="n">btk_lon_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">btk_lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                    <span class="n">btk_lon_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">btk_lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1">#Determine basin if unknown</span>
                <span class="k">if</span> <span class="n">add_basin</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">add_basin</span> <span class="o">=</span> <span class="n">get_basin</span><span class="p">(</span><span class="n">btk_lat</span><span class="p">,</span><span class="n">btk_lon</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_basin</span>
                
                <span class="c1">#Get other relevant variables</span>
                <span class="n">btk_wind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">btk_mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ucar&#39;</span><span class="p">:</span>
                    <span class="n">btk_type</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">btk_type</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">btk_type</span> <span class="o">==</span> <span class="s2">&quot;TY&quot;</span> <span class="ow">or</span> <span class="n">btk_type</span> <span class="o">==</span> <span class="s2">&quot;ST&quot;</span><span class="p">:</span> <span class="n">btk_type</span> <span class="o">=</span> <span class="s2">&quot;HU&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span>

                <span class="c1">#Replace with NaNs</span>
                <span class="k">if</span> <span class="n">btk_wind</span> <span class="o">&gt;</span> <span class="mi">250</span> <span class="ow">or</span> <span class="n">btk_wind</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> <span class="n">btk_wind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">btk_mslp</span> <span class="o">&gt;</span> <span class="mi">1040</span> <span class="ow">or</span> <span class="n">btk_mslp</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span> <span class="n">btk_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1">#Add extra obs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1">#Append into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_lon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_mslp</span><span class="p">)</span>
                
                <span class="c1">#Add basin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_basin</span><span class="p">)</span>

                <span class="c1">#Calculate ACE &amp; append to storm total</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">btk_wind</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">btk_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1">#Add storm name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            
<div class="viewcode-block" id="Realtime.list_active_storms"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.Realtime.list_active_storms.html#tropycal.realtime.Realtime.list_active_storms">[docs]</a>    <span class="k">def</span> <span class="nf">list_active_storms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a list of storms currently stored in Realtime.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List containing the storm IDs for currently active storms. Each ID has a Storm object stored as an attribute of Realtime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storms</span></div>
    
<div class="viewcode-block" id="Realtime.get_storm"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.Realtime.get_storm.html#tropycal.realtime.Realtime.get_storm">[docs]</a>    <span class="k">def</span> <span class="nf">get_storm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a RealtimeStorm object for the requested storm ID.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : str</span>
<span class="sd">            Storm ID for the requested storm (e.g., &quot;AL012020&quot;).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tropycal.realtime.RealtimeStorm</span>
<span class="sd">            An instance of RealtimeStorm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to see if storm is available</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">storm</span><span class="se">\&quot;</span><span class="s2"> must be of type str.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">storm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">storms</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Requested storm ID is not contained in this object.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Return RealtimeStorm object</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span></div></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Tropycal Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>